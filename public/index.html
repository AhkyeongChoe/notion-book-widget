<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Notion Book Widget</title>
</head>
<body>
  <h2>ğŸ“š ì±… ê²€ìƒ‰</h2>

  <input id="query" placeholder="ì±… ì œëª© ì…ë ¥" />
  <button onclick="search()">ê²€ìƒ‰</button>

  <div id="result"></div>

  <script>
  async function search() {
    const q = document.getElementById("query").value;

    const res = await fetch(
      `https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(q)}&maxResults=10`
    );
    const data = await res.json();

    const results = document.getElementById("result");
    results.innerHTML = "";

    if (!data.items || data.items.length === 0) {
      results.innerHTML = "<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
      return;
    }

    data.items.slice(0, 10).forEach(item => {
      const book = item.volumeInfo;

      const title = book.title || "ì œëª© ì—†ìŒ";
      const authors = book.authors?.join(", ") || "ì €ì ì •ë³´ ì—†ìŒ";
      const thumbnail = book.imageLinks?.thumbnail || "";
      const publisher = book.publisher || "ì¶œíŒì‚¬ ì •ë³´ ì—†ìŒ";
      const publishedDate = book.publishedDate || "ì¶œê°„ì¼ ì •ë³´ ì—†ìŒ";

      const div = document.createElement("div");
      div.style.border = "1px solid #ddd";
      div.style.padding = "8px";
      div.style.marginBottom = "8px";

      div.innerHTML = `
        <strong>${title}</strong><br/>
        <small>${authors}</small><br/>
        <small>${publisher} (${publishedDate})</small><br/>
        ${thumbnail ? `<img src="${thumbnail}" />` : ""}
        <br/>
        <button>ë…¸ì…˜ì— ì¶”ê°€</button>
      `;

      div.querySelector("button").onclick = () => {
        addBook({ title, authors, thumbnail, publisher, publishedDate });
      };

      results.appendChild(div);
    });
  }
   

    async function addBook(book) {
      await fetch("/api/addBook", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(book)
      });
      alert("ë…¸ì…˜ì— ì¶”ê°€ë¨!");
    }
  </script>

  <small>Powered by Google Books</small>
</body>
</html>
